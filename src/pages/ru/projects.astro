---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import ImageModal from '../../components/ui/ImageModal.astro';

import snappyImg from '../../assets/projects/snappy.png';
import rizqImg from '../../assets/projects/rizq.png';
import oleoImg from '../../assets/projects/oleo.png';
import procareImg from '../../assets/projects/procare.png';

const lang = 'ru';

// Категории фильтров
const categories = [
  { name: 'Все', filter: 'all', active: true },
  { name: 'Веб Дизайн', filter: 'Web Dizayn', active: false },
  { name: 'Моушн Графика', filter: 'Motion Grafika', active: false },
  { name: 'Графический Дизайн', filter: 'Grafik Dizayn', active: false },
  { name: 'Брендинг', filter: 'Branding', active: false },
  { name: '3D Дизайн', filter: '3D Dizayn', active: false },
  { name: 'Дизайн Приложений', filter: 'App Dizayn', active: false },
  { name: 'Упаковка', filter: 'Packaging', active: false },
];

// Все проекты
const allProjects = [
  // Branding
  { image: '/images/Pokla.png', title: 'Pokla', description: 'Проект брендинга', tag: 'Branding', modalImage: '/images/Pokla.png' },
  { image: oleoImg.src, title: 'Oleo', description: 'Дизайн бренда', tag: 'Branding', href: '/ru/projects/mimi' },
  { image: '/images/BF.png', title: 'BF', description: 'Проект брендинга', tag: 'Branding', modalImage: '/images/BF.png' },
  { image: '/images/Dcard.png', title: 'Dcard', description: 'Дизайн карты', tag: 'Branding', modalImage: '/images/Dcard.png' },
  { image: '/images/Tikoncha.png', title: 'Tikoncha', description: 'Проект брендинга', tag: 'Branding', modalImage: '/images/Tikoncha.png' },

  // Web Dizayn
  { image: snappyImg.src, title: 'Snappy', description: 'Стриминговая платформа', tag: 'Web Dizayn', href: '/ru/projects/snappy' },
  { image: '/images/web/Bright Future.png', title: 'Bright Future', description: 'Дизайн веб-сайта', tag: 'Web Dizayn', modalImage: '/images/web/Bright Future.png' },
  { image: '/images/web/Davo delivery.png', title: 'Davo Delivery', description: 'Служба доставки', tag: 'Web Dizayn', modalImage: '/images/web/Davo delivery.png' },
  { image: '/images/web/PirateHub.png', title: 'PirateHub', description: 'Дизайн веб-сайта', tag: 'Web Dizayn', modalImage: '/images/web/PirateHub.png' },
  { image: '/images/web/Poligraf extra.png', title: 'Poligraf Extra', description: 'Полиграфические услуги', tag: 'Web Dizayn', modalImage: '/images/web/Poligraf extra.png' },
  { image: '/images/web/Pro Care.png', title: 'Pro Care', description: 'Медицинский сайт', tag: 'Web Dizayn', modalImage: '/images/web/Pro Care.png' },
  { image: '/images/web/Safe Logs.png', title: 'Safe Logs', description: 'Система безопасности', tag: 'Web Dizayn', modalImage: '/images/web/Safe Logs.png' },
  { image: '/images/web/TXT Group.png', title: 'TXT Group', description: 'Корпоративный сайт', tag: 'Web Dizayn', modalImage: '/images/web/TXT Group.png' },

  // App Dizayn
  { image: procareImg.src, title: 'ProCare', description: 'Медицинское приложение', tag: 'App Dizayn', href: '/ru/projects/procare' },

  // 3D Dizayn
  { image: rizqImg.src, title: 'Rizq', description: '3D визуализация', tag: '3D Dizayn', href: '/ru/projects/rizq' },

  // Packaging
  { image: '/images/Andijon package.png', title: 'Andijon', description: 'Дизайн упаковки', tag: 'Packaging', modalImage: '/images/Andijon package.png' },
];

// Верхний ряд
const topRowProjects = [
  allProjects[0],
  allProjects[5],
  allProjects[6],
  allProjects[13],
  allProjects[7],
  allProjects[2],
];

// Нижний ряд
const bottomRowProjects = [
  allProjects[14],
  allProjects[8],
  allProjects[3],
  allProjects[9],
  allProjects[4],
  allProjects[11],
];
---

<Layout title="Проекты - Bright Future" description="Проекты дизайн агентства Bright Future">
  <Header lang={lang} />

  <main class="projects-page">
    <!-- Header Section -->
    <div class="projects-header">
      <h1 class="projects-title">Проекты</h1>

      <!-- Category Filters -->
      <div class="categories">
        {categories.slice(0, 4).map((cat) => (
          <button
            class:list={['category-btn', cat.active && 'category-btn--active']}
            data-filter={cat.filter}
          >
            {cat.name}
          </button>
        ))}
      </div>
      <div class="categories">
        {categories.slice(4).map((cat) => (
          <button
            class:list={['category-btn', cat.active && 'category-btn--active']}
            data-filter={cat.filter}
          >
            {cat.name}
          </button>
        ))}
      </div>
    </div>

    <!-- Projects Section -->
    <div class="projects-section">
      <!-- Background Title -->
      <div class="projects-bg-title">Проекты</div>

      <!-- Marquee container -->
      <div class="marquee-container" id="marquee-container">
        <!-- Top Row -->
        <div class="marquee">
          <div class="marquee__track marquee__track--right">
            {[...topRowProjects, ...topRowProjects, ...topRowProjects].map((project) => (
              <div class="project-card" data-category={project.tag}>
                <div class="project-card__image-wrap">
                  {project.modalImage ? (
                    <a
                      href="#"
                      class="project-card__link"
                      data-modal-image={project.modalImage}
                      data-modal-alt={project.title}
                    >
                      <img src={project.image} alt={project.title} loading="lazy" />
                    </a>
                  ) : (
                    <a href={project.href} class="project-card__link">
                      <img src={project.image} alt={project.title} loading="lazy" />
                    </a>
                  )}
                </div>
                <div class="project-card__info">
                  <div class="project-card__text">
                    <h3 class="project-card__title">{project.title}</h3>
                    <p class="project-card__desc">{project.description}</p>
                  </div>
                  <span class="project-card__tag">{project.tag}</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        <!-- Bottom Row -->
        <div class="marquee">
          <div class="marquee__track marquee__track--left">
            {[...bottomRowProjects, ...bottomRowProjects, ...bottomRowProjects].map((project) => (
              <div class="project-card" data-category={project.tag}>
                <div class="project-card__image-wrap">
                  {project.modalImage ? (
                    <a
                      href="#"
                      class="project-card__link"
                      data-modal-image={project.modalImage}
                      data-modal-alt={project.title}
                    >
                      <img src={project.image} alt={project.title} loading="lazy" />
                    </a>
                  ) : (
                    <a href={project.href} class="project-card__link">
                      <img src={project.image} alt={project.title} loading="lazy" />
                    </a>
                  )}
                </div>
                <div class="project-card__info">
                  <div class="project-card__text">
                    <h3 class="project-card__title">{project.title}</h3>
                    <p class="project-card__desc">{project.description}</p>
                  </div>
                  <span class="project-card__tag">{project.tag}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      <!-- Grid container -->
      <div class="filtered-grid" id="filtered-grid" style="display: none;">
        {allProjects.map((project) => (
          <div class="project-card project-card--grid" data-category={project.tag}>
            <div class="project-card__image-wrap">
              {project.modalImage ? (
                <a
                  href="#"
                  class="project-card__link"
                  data-modal-image={project.modalImage}
                  data-modal-alt={project.title}
                >
                  <img src={project.image} alt={project.title} loading="lazy" />
                </a>
              ) : (
                <a href={project.href} class="project-card__link">
                  <img src={project.image} alt={project.title} loading="lazy" />
                </a>
              )}
            </div>
            <div class="project-card__info project-card__info--visible">
              <div class="project-card__text">
                <h3 class="project-card__title">{project.title}</h3>
                <p class="project-card__desc">{project.description}</p>
              </div>
              <span class="project-card__tag">{project.tag}</span>
            </div>
          </div>
        ))}
      </div>

      <!-- Empty state -->
      <div class="empty-state" id="empty-state" style="display: none;">
        <p>В этой категории проектов не найдено</p>
      </div>
    </div>
  </main>

  <Footer lang={lang} />
  <ImageModal />
</Layout>

<style>
  .projects-page {
    min-height: 100vh;
    overflow: hidden;
  }

  .projects-header {
    text-align: center;
    padding: 3rem 1.5rem 4rem;
  }

  .projects-title {
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 600;
    color: var(--color-black, #000);
    margin: 0 0 2rem;
  }

  .categories {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .category-btn {
    padding: 0.875rem 1.75rem;
    border-radius: 3rem;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: white;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--color-black, #000);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .category-btn:hover {
    border-color: var(--color-primary, #13499F);
    color: var(--color-primary, #13499F);
  }

  .category-btn--active {
    background: var(--color-primary, #13499F);
    border-color: var(--color-primary, #13499F);
    color: white;
  }

  .category-btn--active:hover {
    background: var(--color-primary, #13499F);
    color: white;
  }

  .projects-section {
    position: relative;
    padding-bottom: 4rem;
  }

  .projects-bg-title {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: clamp(10rem, 25vw, 20rem);
    font-weight: 600;
    color: rgba(0, 0, 0, 0.03);
    white-space: nowrap;
    pointer-events: none;
    z-index: 0;
    line-height: 0.9;
  }

  .marquee {
    position: relative;
    z-index: 1;
    width: 100%;
    overflow: hidden;
  }

  .marquee__track {
    display: flex;
    gap: 1.5rem;
    width: max-content;
    padding: 1rem 0 5rem;
  }

  .marquee__track--right {
    animation: scroll-right 60s linear infinite;
  }

  .marquee__track--left {
    animation: scroll-left 60s linear infinite;
  }

  .marquee:hover .marquee__track {
    animation-play-state: paused;
  }

  @keyframes scroll-right {
    0% { transform: translateX(-33.33%); }
    100% { transform: translateX(0); }
  }

  @keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-33.33%); }
  }

  .project-card {
    position: relative;
    flex-shrink: 0;
  }

  .project-card__image-wrap {
    width: 320px;
    height: 240px;
    border-radius: 1rem;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    background: white;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .project-card:hover .project-card__image-wrap {
    transform: scale(1.02);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
  }

  .project-card__link {
    display: block;
    width: 100%;
    height: 100%;
  }

  .project-card__link img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  @media (min-width: 1200px) {
    .project-card__image-wrap {
      width: 380px;
      height: 285px;
    }
  }

  @media (min-width: 1400px) {
    .project-card__image-wrap {
      width: 420px;
      height: 315px;
    }
  }

  .project-card__info {
    position: absolute;
    bottom: -3.5rem;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-5px);
    transition: all 0.3s ease;
  }

  .project-card:hover .project-card__info {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .project-card__text {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
  }

  .project-card__title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-primary, #13499F);
    text-decoration: underline;
    text-underline-offset: 3px;
    margin: 0;
    white-space: nowrap;
  }

  .project-card__desc {
    font-size: 0.85rem;
    color: var(--color-gray, #8C8C8C);
    margin: 0;
    white-space: nowrap;
  }

  .project-card__tag {
    padding: 0.4rem 1rem;
    border: 1px solid rgba(140, 140, 140, 0.4);
    border-radius: 2rem;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--color-black, #000);
    background: white;
    flex-shrink: 0;
    white-space: nowrap;
  }

  .filtered-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .filtered-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 2.5rem;
      padding: 2rem 3rem;
    }
  }

  @media (min-width: 1200px) {
    .filtered-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 3rem;
      padding: 2rem 4rem;
    }
  }

  .project-card--grid {
    position: relative;
  }

  .project-card--grid .project-card__image-wrap {
    width: 100%;
    height: auto;
    aspect-ratio: 4/3;
  }

  .project-card__info--visible {
    position: relative;
    bottom: auto;
    opacity: 1;
    visibility: visible;
    transform: none;
    margin-top: 1rem;
  }

  .project-card--grid.hidden {
    display: none;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--color-gray, #8C8C8C);
    font-size: 1.1rem;
  }
</style>

<script>
  const marqueeContainer = document.getElementById('marquee-container');
  const filteredGrid = document.getElementById('filtered-grid');
  const emptyState = document.getElementById('empty-state');
  const filterButtons = document.querySelectorAll('.category-btn');
  const gridCards = filteredGrid?.querySelectorAll('.project-card--grid');

  function filterProjects(filter: string) {
    if (filter === 'all') {
      if (marqueeContainer) marqueeContainer.style.display = 'block';
      if (filteredGrid) filteredGrid.style.display = 'none';
      if (emptyState) emptyState.style.display = 'none';
    } else {
      if (marqueeContainer) marqueeContainer.style.display = 'none';
      if (filteredGrid) filteredGrid.style.display = 'grid';

      let visibleCount = 0;

      gridCards?.forEach((card) => {
        const category = card.getAttribute('data-category');
        if (category === filter) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      if (emptyState) {
        emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
      }
    }
  }

  filterButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      filterButtons.forEach(b => b.classList.remove('category-btn--active'));
      btn.classList.add('category-btn--active');
      const filter = btn.getAttribute('data-filter') || 'all';
      filterProjects(filter);
    });
  });
</script>
